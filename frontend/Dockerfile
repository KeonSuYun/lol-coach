# frontend/Dockerfile

# ç¬¬ä¸€é˜¶æ®µï¼šæž„å»º
FROM node:18-alpine as builder
WORKDIR /app
COPY package.json package-lock.json ./
RUN npm install
COPY . .
RUN npm run build

# ç¬¬äºŒé˜¶æ®µï¼šè¿è¡Œ (ç”¨ Nginx æžé€ŸæœåŠ¡)
FROM nginx:alpine

# å¤åˆ¶æž„å»ºäº§ç‰©
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

# ðŸ”¥ [æ ¸å¿ƒä¿®æ”¹] å¯åŠ¨å‘½ä»¤æ”¹ä¸º Shell è„šæœ¬
# ä½œç”¨ï¼šå¯åŠ¨å‰è¯»å–ç³»ç»ŸçŽ¯å¢ƒå˜é‡ï¼Œç”Ÿæˆ env-config.js æ–‡ä»¶ï¼Œè®©å‰ç«¯ JS èƒ½è¯»åˆ°
CMD ["/bin/sh", "-c", "echo \"window._env_ = { \
  VITE_PAN_LINK: '${VITE_PAN_LINK}', \
  VITE_PAN_PWD: '${VITE_PAN_PWD}', \
  VITE_DIRECT_LINK: '${VITE_DIRECT_LINK}' \
};\" > /usr/share/nginx/html/env-config.js && nginx -g 'daemon off;'"]